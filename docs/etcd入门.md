## `etcd`简介
可靠的分布式`KV`存储，底层使用`Raft`算法保证一致性。主要用于共享配置和服务发现。
### 数据模型
`etcd`支持可靠的键值对存储，并提供了可靠的`Watcher`机制。
键值对存储支持多版本。
即：对某个`key`的修改，不会直接删除`oldvalue`,而是同时存在`oldvalue`和`newvalue`, 通过不同的版本号进行区分。

为了缓解运行压力，每隔一定的时间，`etcd`会清理过旧的数据。
为了加快查询速度，采用了`B`树的索引结构。
`etcd`维护了一个全局自增的版本号，为每次事务分配一个全局唯一的版本号。
事务中的操作也有唯一的编号(`sub revision`), 通过这两个部分，可以唯一的确定`value`值。

`etcd`各模块主要功能：
* `raft`: `raft`协议的核心实现，实现了基本的`raft`协议，并未提供实现网络层的相关内容；
* `raft-http`: `raft`各节点发送消息时使用的网络层实现，该模块与`raft`模块紧密相关;
* `wal和snap`： `WAL`日志和快照存储相关的实现
* `store`: `etcd`的存储实现`v2`版，该版本完全基于内存实现；
* `mvcc`: `etcd`存储的`v3`版，底层使用`BoltDB`实现持久存储；
* `lease`: 租约相关的实现；
* `auth和alarm`： 权限与报警相关实现
* `etcdserver`: `etcd`服务端实现，基于上述模块的功能，对外提供一个`etcd`节点完整功能；
* `client`: `v2`版客户端实现，主要通过`http+json`方式与服务端交互；
* `clientv3`: `v3`版客户端实现，通过`GRPC`与客户端交互。




